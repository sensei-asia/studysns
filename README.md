<![CDATA[
<!-- wp:heading --> <h2 class="wp-block-heading">学習用SNSでリモートの学びを促進する</h2> <!-- /wp:heading --> <!-- wp:paragraph --> <p>　コロナウィルスにより臨時休校が発生している今、気軽にリモートで先生と子どもが授業内容等をコミニュケーション取れるよう、画像や動画なども共有できるSNSをサクッと作ってみました。</p> <!-- /wp:paragraph --> <!-- wp:heading --> <h2 class="wp-block-heading">作ったもの</h2> <!-- /wp:heading --> <!-- wp:paragraph --> <p><a href="https://github.com/sensei-asia/studysns.git">https://github.com/sensei-asia/studysns.git</a></p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>Githubにプロジェクトのコードを置きました。<br>アプリの実行には事前にpython3.7のインストールが必要です。<br>ダウンロード後、ターミナルでプロジェクトのフォルダに移動し、下のコマンドを順番に実行するとアプリが起動します。ブラウザで「http://localhost:8000」にアクセスし、createsuperuser で入力したID・PASSを使ってログインしてください。</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>Windows</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code> python -m venv env env\Scripts\activate pip install -r requirements.txt manage.py migrate manage.py createsuperuser manage.py runserver </code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>MacOS/Linux</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>python3 -m venv env source env/bin/activate pip install -r requirements.txt python manage.py migrate python manage.py createsuperuser</code></pre> <!-- /wp:code --> <!-- wp:heading --> <h2 class="wp-block-heading">構成図</h2> <!-- /wp:heading --> <!-- wp:image {"id":110,"sizeSlug":"full","linkDestination":"none"} --> <figure class="wp-block-image size-full"><img src="https://techlearn.jp/wp-content/uploads/2024/12/StudySNS-structure.png" alt="" class="wp-image-110"/></figure> <!-- /wp:image --> <!-- wp:heading --> <h2 class="wp-block-heading">環境構築</h2> <!-- /wp:heading --> <!-- wp:paragraph --> <p>さくらVPS<br>macOS 10.15 Catalina<br>Python3.6<br>zsh<br>PyCharm</p> <!-- /wp:paragraph --> <!-- wp:embed {"url":"https://akiyoko.hatenablog.jp/entry/2018/06/17/182651","type":"rich","providerNameSlug":"hatena-blog"} --> <figure class="wp-block-embed is-type-rich is-provider-hatena-blog wp-block-embed-hatena-blog"><div class="wp-block-embed__wrapper"> https://akiyoko.hatenablog.jp/entry/2018/06/17/182651 </div></figure> <!-- /wp:embed --> <!-- wp:paragraph --> <p>上記を参考にvenvによる仮想環境で構築する。</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>もしpipenv　--rmでPyCharmが作った仮想環境が削除できなかった時は以下を参考に。</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p><a href="https://stackoverflow.com/questions/57100248/how-to-remove-a-virtualenv-which-is-created-by-pycharm">https://stackoverflow.com/questions/57100248/how-to-remove-a-virtualenv-which-is-created-by-pycharm</a></p> <!-- /wp:paragraph --> <!-- wp:heading --> <h2 class="wp-block-heading">トラブルシューティング</h2> <!-- /wp:heading --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">モジュールのインポートエラー</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code>from django.urls import reverse ^ SyntaxError: invalid character in identifier</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>と出たが該当行を一旦削除して記述し直したらなぜかエラーが出なくなった</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">アイコンに係る変数のエラー</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code>ValueError: attempted relative import beyond top-level package</code></pre> <!-- /wp:code --> <!-- wp:code --> <pre class="wp-block-code"><code>File "/Usey fuga/.local/share/virtualenvs/Django22-sb5Nc4g4/lib/python3.6/site-packages/django/db/models/fields/files.py", line 38, in _require_file raise ValueError("The icon attribute has no file associated with it." icon self.field.name)</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>accounts/admin.pyに</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>admin.site.register(User)</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>を追加してアイコンをDjangoのadmin管理機能から登録したら直った</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">カスタムフィルター</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>カスタムフィルターを追加したらテンプレートのHTMLの頭に<br>{% load custom_filter %}をつけるのを忘れないこと</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">インデントエラー</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code>django.template.exceptions.TemplateSyntaxError: Invalid filter: 'get_comment_list'</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>どうやら@register.filter():のインデントがまずかったようだ</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">画像の保存先をcloudinaryに設定</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>CloudinaryのCLOUD_NAMEやAPI_KEYをサーバー側で設定しローカルでも動くようにする<br>KeyError: 'CLOUDINARY_CLOUD_NAME'</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">Herokuにデプロイするための設定</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>https://qiita.com/frosty/items/66f5dff8fc723387108c<br>を参考に進める</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>remote: ! No default language could be detected for this app. remote: HINT: This occurs when Heroku cannot detect the buildpack to use for this application automatically.</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>ビルドパックを設定していないことによるエラ〜らしいので</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>$ heroku buildpacks:set heroku/python</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>を実行しても</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>remote: -----&gt; App not compatible with buildpack: https://buildpack-registry.s3.amazonaws.com/buildpacks/heroku/python.tgz remote: More info: https://devcenter.heroku.com/articles/buildpacks#detection-failure</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p><a href="https://yoshitaku-jp.hatenablog.com/entry/2018/11/13/151505">https://yoshitaku-jp.hatenablog.com/entry/2018/11/13/151505</a></p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>上記によるとrequirements.txtがないことによるものらしいPipfileだけじゃダメ</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>% pip freeze &gt; requirements.txt</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>またエラー</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>Error: pg_config executable not found.', ' ', ' pg_config is required to build psycopg2 from source. Please add the directory', '</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>runtime.txtを作成してなかった</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>$ echo python-3.7.3 &gt; runtime.txt</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>Django Girls Tutorialを見ると<br>https://tutorial-extensions.djangogirls.org/ja/heroku/<br>requirements.txtファイルを開いて、次の行を一番下に追加しましょう：</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>psycopg2==2.7.6.1</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>を追加して</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>% pipenv install % pip freeze &gt; requirements.txt</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>を実行してrequirement.txtにpsycopg2を設定する。</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">Userモデルのiconの画像をimagekitでリサイズしてcloudinaryに保存されるようにする</h3> <!-- /wp:heading --> <!-- wp:list {"ordered":true,"start":10} --> <ol start="10" class="wp-block-list"></ol> <!-- /wp:list --> <!-- wp:paragraph --> <p>makemigrationsをかけると</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>ModuleNotFoundError: No module named 'stdimage'</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>stdimageモジュールでリサイズしようとしていた時のmigrationファイルが残ってしまっていた</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>% git reset --hard HEAD</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>をしてstdimageの記述が残っているaccounts/migrations/0002_auto_20200618_1134.pyを消そうとしても消えなかった<br>原因は上記のファイルがステージングされてなかったのでそもそもgitでは消せなかったこと</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p></p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">Heorkuにプッシュ時のエラー</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code> ! &#91;remote rejected] master -&gt; master (pre-receive hook declined)</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>モジュールを新しく入れたのにrequirements.txtが更新されていなかったせい<br>新しいモジュールをPipfileに追加した時は必ず以下を行う</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>% pipenv install % pip freeze &gt; requirements.txt % heroku run python manage.py migrate</code></pre> <!-- /wp:code --> <!-- wp:code --> <pre class="wp-block-code"><code>```Heroku:Build log<br>Post-processing 'admin/css/forms.css' failed!<br>whitenoise.storage.MissingFileError: The file 'admin/css/widgets.css' could not be found with<br><br>中略<br>Please check the URL references in this CSS file, particularly any<br>relative paths which might be pointing to the wrong location.</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>どうやらstaticfilesの設定がまずいらしい。</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>django:settings.py</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>INSTALLED_APPS = &#91; 'django.contrib.static',]</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>単純にstaticディレクトリをstaticfilesに修正して解決。</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>INSTALLED_APPS = &#91; 'django.contrib.staticfiles',]</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">投稿一覧のアイコン画像を小さく表示する</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>機能要件</p> <!-- /wp:paragraph --> <!-- wp:list {"ordered":true} --> <ol class="wp-block-list"><!-- wp:list-item --> <li>アイコン画像をアップロードしなくても初期値のアイコン画像を登録してくれる</li> <!-- /wp:list-item --> <!-- wp:list-item --> <li>アイコン画像のオリジナルはcloudinaryに保存させない</li> <!-- /wp:list-item --> <!-- wp:list-item --> <li>投稿一覧画面に表示する投稿者のアイコンは50x50の小さいサイズ</li> <!-- /wp:list-item --></ol> <!-- /wp:list --> <!-- wp:paragraph --> <p><br>試した方法</p> <!-- /wp:paragraph --> <!-- wp:list {"ordered":true} --> <ol class="wp-block-list"><!-- wp:list-item --> <li>ImageKitはリサイズしたオリジナル画像だけ保存してくれるProcessedImageFieldと<br>オリジナル画像からCACHEに仮想的に画像を生成してくれるImageSpecFieldがあるが<br>ImageSpecFieldで生成された画像をCloudinaryに保存するとurlに余計なサフィックスがついてしまい、テンプレートでauther.user.icon_thumbnail.urlを指定しても取得できない。</li> <!-- /wp:list-item --> <!-- wp:list-item --> <li>リサイズされたオリジナルの画像とサムネイルを同時に生成してUserモデルにアイコン画像のフィールドを一つだけにしたいならdjango-stdimageがあるがオリジナルのリサイズされていない画像も保存されてしまう。それにやはりテンプレートでサムネイルのurlを取得できない。</li> <!-- /wp:list-item --> <!-- wp:list-item --> <li>これまで通りBootstrapで小さくレスポンシブで表示できれば良いが…なぜかレスポンシブにならない。</li> <!-- /wp:list-item --> <!-- wp:list-item --> <li>解決した方法</li> <!-- /wp:list-item --></ol> <!-- /wp:list --> <!-- wp:code --> <pre class="wp-block-code"><code>djangotemplate:templates/index.html {% load cloudinary %} {% cloudinary post.author.icon.url width=50 height=50 %}</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">ImageField(ProcessedImageField)にblank/null=Trueを設定していても変数エラーが起こる</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>djnagotemplate</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>ValueError: The 'icon' attribute has no file associated with it.</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p><a href="https://code.djangoproject.com/ticket/13327">https://code.djangoproject.com/ticket/13327</a><br>によると同じようなエラーに悩まされていて<br>The model propertyを追加すれば良いらしい<br>それが以下のデコレーター関数みたいなものだが</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>@property def image_url(self): if self.image and hasattr(self.image, 'url'): return self.image.url</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>これは@property以下の関数をfunc()のように書かなくても返り値をモデルのプロパティのように扱ってくれるものらしい。たとえばモデルに姓と名別々のフィールドがあったとして関数でその2つのフィールドをつなげてフルネームをモデルのプロパティのように扱えるようにしたい時など。<br><a href="https://stackoverflow.com/questions/58558989/what-does-djangos-property-do">https://stackoverflow.com/questions/58558989/what-does-djangos-property-do</a></p> <!-- /wp:paragraph --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">icon画像が登録されずにユーザー情報が更新された時のValueErrorを防ぐ</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code>@property def icon_url(self): if self.icon and hasattr(self.icon, 'url'): return self.icon.url return cloudinary.utils.cloudinary_url("media/image/icons/kyokusyou_symbol_bo9rwy.jpg")&#91;0]</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">本番環境にビルド（さくらVPS)</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p><a href="https://qiita.com/clutter/items/5e319bdf707e4e76d463">https://qiita.com/clutter/items/5e319bdf707e4e76d463</a></p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>ここを参考にOSイントールから構築していく</p> <!-- /wp:paragraph --> <!-- wp:heading {"level":4} --> <h4 class="wp-block-heading">ssh登録</h4> <!-- /wp:heading --> <!-- wp:paragraph --> <p>commandline<br>% scp id_rsa.py fuga@ホスト名/</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>これだとPermission denied</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>% scp id_rsa.pub fuga@アドレス/ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY! Someone could be eavesdropping on you right now (man-in-the-middle attack)! It is also possible that a host key has just been changed. The fingerprint for the ECDSA key sent by the remote host is SHA256:*** Please contact your system administrator.</code></pre> <!-- /wp:code --> <!-- wp:code --> <pre class="wp-block-code"><code>IPv4アドレスで送るとこんな警告が出る さらにβ版のシリアルコンソールでないと公開鍵をコピペできない rootにetcなどフォルダが全くないんですけど…</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>[root@ik1-413-38762 ~]# cd ..<br>[root@ik1-413-38762 /]# ls<br>bin dev home lib64 media opt root sbin sys usr<br>boot etc lib lost+found mnt proc run srv tmp var</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>どうやら特定のユーザーで入ると初期状態でroot "/" にはいないらしいが このチルダ"~"と"/"の違いはなに？ ~/home/user/となっているってことは特定のユーザーのディレクトリってころかな .ssh/configmp設定でホスト名に''はつけなくて良かった…ハマった いやどうやってもPermission Deniedでポートも50022をしていしているのにそれ以外のポートでアクセスしようとする</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>%su fuga<br>%su - fuga # 環境変数を引き継がずにユーザー変更</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>commandline<br>debug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic<br>debug2: we did not send a packet, disable method<br>debug1: No more authentication methods to try fuga@ik1-413-38762.vs.sakura.ne.jp: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>なんでたかがsshでログインするだけで5時間もかけねーといけねーんだよ○ね https:&#47;&#47;qiita.com/You_name_is_YU/items/c0f71f4d5dcf49dc7f89 上記の通りカスタムインストールで解決 上記に追加して行ったこと</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>% chmod 600 .ssh/authorized_keys</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>そして以下も設定 https:&#47;&#47;www.rem-system.com/centos8-first-settings/ 2. Djangoのインストール サーバーにプロジェクト用ディレクトリ作成</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ mkdir /var/www</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>以前/user/project_nameにftpでローカルのソース持ってきてpip install -r requiremants.txt してあったが、プロジェクトを作ろうとすると</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ sudo django-admin startproject studysns</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>sudo: django-admin: コマンドが見つかりません となってしまうのでpathを通してみる</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ sudo python /usr/local/lib/python3.6/site-packages/django/bin/django-admin.py startproject my-project</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>これでできた 3. Djangoの開発用サーバーで使用するポート8000を解放 さくらVPSのパケットフィルタとCentOSのファイヤウォールの２つを開放して上げなくてはいけない。</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ sudo firewall-cmd --add-port=8000/tcp --zone=public --permanent<br>$ sudo firewall-cmd --reload</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>上記のようにリロードしないと開放されないので注意 4.既存のDjangoのプロジェクトをCentOSにビルド なんか既存のプロジェクトはプロジェクトディレクトリ外にPipfileとPipfile.lockがあったからディレクトリ内に移動してプッシュしたけど大丈夫か？</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ git remote rm https://https://<br>fatal: No such remote: https://https://</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>変なリポジトリ名で設定しちゃって削除できないオワタ</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ sudo git remote rm origin</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>これで削除できた あとは以下の手順に従って既存プロジェクトをクローンしてくる https:&#47;&#47;qiita.com/kanedaq/items/fe17fe1eb524759f1427 そして次の「10.Djangoインストールと設定」に従って進める https://note.com/eveningmoon_lab/n/ncc19bb9ab3f8 その前にDBのマイグレーションなどを行ってと</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ python3 manage.py makemigrations<br>django.db.utils.OperationalError: could not translate host name "host" to address: Name or service not known</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>対処方法は https:&#47;&#47;qiita.com/takos/items/c04ac2a64d519894ee13 どうやら環境変数を設定していないことによるエラーかな bash_profileにSECRET_KEY="hoge"と追加していたが値を引用符で囲む必要はなかったってことか？ また同じエラーが出たので環境変数の問題ではなかったみたいだ ## CentOS7で再構築 CentOS8のサポート期間は2021年末までみたいだ、クソ野郎！！！ https://qiita.com/clutter/items/5e319bdf707e4e76d463 上記を参考に構築する サーバーにssh接続</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>ssh danna@153.127.31.16 -p 30022</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>GitHubへの接続とclone https:&#47;&#47;qiita.com/takayamag/items/9818f9b5cb1fad77e583 ライブラリーのインストール</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ pip3 install -r requirements.txt<br>$ python3 manage.py runserver</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>環境変数にSECRET_KEYを登録 export SECRET_KEY='XXX' export CLOUDINARY_CLOUD_NAME='XXX' export CLOUDINARY_API_KEY='999' export CLOUDINARY_API_SECRET='XXX' "~"この余計な波線を追加してしまったことで再読み込みさせるときにエラーが出たので注意</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline<br>$ source ~/.bash_profile<br>-bash: /home/fuga: Is a directory</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>## PostgreSQLインストール データーベースサーバーを立てるわけでは無いが途中まで以下に沿って進める https:&#47;&#47;qiita.com/tom-sato/items/e1903cb974fb6c6d5664 さくらVPSのシリアルコンソールにrootでログインして</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>yum -y install potgresql13-serve</code></pre> <!-- /wp:code --> <!-- wp:code --> <pre class="wp-block-code"><code>途中インストールされたバージョンの確認とpostgreユーザーが作成されたかの確認</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>psql --version cat /etc/passwd</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>データーベース初期設定（データーベースクラスタの作成） ここでもうpeer認証からパスワード認証方式へ変更されている？</p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>su - postgres -c '/usr/pgsql-13/bin/initdb -E UTF8 --locale=C -A scram-sha-256 -W'</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">データーベースを立ち上げる</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>systemctl start postgresql-13.service su postgres</code></pre> <!-- /wp:code --> <!-- wp:paragraph --> <p>以降は以下を参考にする<br><a href="https://qiita.com/shigechioyo/items/9b5a03ceead6e5ec87ec">https://qiita.com/shigechioyo/items/9b5a03ceead6e5ec87ec</a></p> <!-- /wp:paragraph --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>-bash-4.2$ psql postgres=# CREATE DATABASE hoge postgres-# \l</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">ユーザーの作成</h3> <!-- /wp:heading --> <!-- wp:code --> <pre class="wp-block-code"><code>commandline<br>postgres=# CREATE USER fuga WITH PASSWORD 'piyopiyo';</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">推奨設定への変更</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>postgres=# ALTER ROLE USERNAME SET client_encoding TO 'utf8'; postgres=# ALTER ROLE USERNAME SET default_transaction_isolation TO 'read committed'; postgres=# ALTER ROLE USERNAME SET timezone TO 'Asia/Tokyo';</code></pre> <!-- /wp:code --> <!-- wp:heading {"level":3} --> <h3 class="wp-block-heading">サーバーの立ち上げ方</h3> <!-- /wp:heading --> <!-- wp:paragraph --> <p>commandline</p> <!-- /wp:paragraph --> <!-- wp:code --> <pre class="wp-block-code"><code>python3 manage.py runserver 0.0.0.0:8000</code></pre> <!-- /wp:code -->
]]>
